---
title: "Report on Water, Sanitation and Hygiene"
output: html_document
---

```{r child = "../setup.Rmd"}

```

# Here is task

You work in Uganda and every 5 years your prepare a report for the East African Summit on WASH on how Uganda is performing on WASH.

In previous years, you have downloaded the helpful plots from the washdata.org website and compiled them into a short report.

You realize that you are performing the same task every year. Maybe there is another way to do this more efficiently.

```{r}

jmp_data <- read_csv("https://raw.githubusercontent.com/larnsce/washr/master/data/derived_data/jmp_washdata_indicators_sml.csv")

write_csv(jmp_data, file = "data/washdata.csv")

```

```{r}

# Pre-select your country, year and residence type here

jmp_data_selected <- jmp_data %>% 
  filter(iso3 == "UGA") %>% 
  filter(year == 2017) %>% 
  filter(residence == "national") 


washdata %>% 
  filter(iso3 == "UGA") %>% 
  filter(year == 2017) %>% 
  filter(residence == "national") %>% 
  filter(service == "sanitation")


```

# Global analysis

# Country analysis

## Water

```{r}

jmp_data_selected %>% 
  filter(service == "water") %>% 
  filter(indicator_type == "water_ladder") %>% 
  
  ggplot(aes(x = service, y = percent, fill = indicator)) +
  geom_col() +
  theme_minimal()

```

## Sanitation

```{r}

jmp_data_selected %>% 
  filter(service == "sanitation") %>% 
  filter(indicator_type == "sanitation_ladder") %>% 
  
  ggplot(aes(x = service, y = percent, fill = indicator)) +
  geom_col() +
  theme_minimal()

```

## Hygiene

```{r}

jmp_data_selected %>% 
  filter(service == "hygiene") %>% 
  filter(indicator_type == "hygiene_ladder") %>% 
  
  ggplot(aes(x = service, y = percent, fill = indicator)) +
  geom_col() +
  theme_minimal()

```

```{r}

library(wbstats)
library(dplyr)

```

```{r}

library(tidyverse)
library(wbstats)

my_indicators <- c(
  life_exp = "SP.DYN.LE00.IN", 
  gdp_capita ="NY.GDP.PCAP.CD",
  basic_sanitation = "SH.STA.BASS.ZS",
  sm_sanitation = "SH.STA.SMSS.RU.ZS",
  pop = "SP.POP.TOTL"
  )

d <- wb_data(my_indicators, start_date = 2016)

d %>%
  left_join(wb_countries(), "iso3c") %>%
  ggplot() +
  geom_point(
    aes(
      x = basic_sanitation, 
      y = gdp_capita, 
      size = pop, 
      color = region
      )
    ) +
  scale_x_continuous(
    labels = scales::dollar_format(),
    breaks = scales::log_breaks(n = 10)
    ) +
  coord_trans(x = 'log10') +
  scale_size_continuous(
    labels = scales::number_format(scale = 1/1e6, suffix = "m"),
    breaks = seq(1e8, 1e9, 2e8),
    range = c(1,20)
    ) +
  theme_minimal() +
  labs(
    title = "An Example of Hans Rosling's Gapminder using wbstats",
    x = "GDP per Capita (log scale)",
    y = "Life Expectancy at Birth",
    size = "Population",
    color = NULL,
    caption = "Source: World Bank"
  ) 

```
